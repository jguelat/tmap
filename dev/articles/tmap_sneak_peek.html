<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>tmap v4: a sneak peek • tmap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="tmap v4: a sneak peek">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tmap</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.99.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tmap_sneak_peek.html">tmap v4: a sneak peek</a></li>
    <li><a class="dropdown-item" href="../articles/tmap_vv.html">tmap: charts</a></li>
    <li><a class="dropdown-item" href="../articles/tmap-getstarted.html">tmap: get started!</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-tmap/tmap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>tmap v4: a sneak peek</h1>
                        <h4 data-toc-skip class="author">Martijn
Tennekes</h4>
            
            <h4 data-toc-skip class="date">2024-09-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-tmap/tmap/blob/master/vignettes/tmap_sneak_peek.Rmd" class="external-link"><code>vignettes/tmap_sneak_peek.Rmd</code></a></small>
      <div class="d-none name"><code>tmap_sneak_peek.Rmd</code></div>
    </div>

    
    
<p>The next major update of <strong>tmap</strong> will be a massive one.
Although <strong>tmap</strong> is well-known and widely used in the R
spatial community, there are a couple of bottlenecks that make it
difficult to maintain and extend. The upcoming <strong>tmap</strong>
version 4 (<strong>tmap v4</strong>) aims to overcome these
shortcomings. It is still fully in the development, but now is a good
time for a sneak peek.</p>
<div class="section level2">
<h2 id="extendability">Extendability<a class="anchor" aria-label="anchor" href="#extendability"></a>
</h2>
<p>First and foremost, <strong>tmap v4</strong> will be fully
extendable. More precisely, the following aspects can be extended:</p>
<ul>
<li><p>Map layers: we are not limited anymore by the fixed set of
<code><a href="../reference/tm_polygons.html">tm_polygons()</a></code>, <code><a href="../reference/tm_lines.html">tm_lines()</a></code>,
<code><a href="../reference/tm_symbols.html">tm_symbols()</a></code>, and <code><a href="../reference/tm_raster.html">tm_raster()</a></code> (and their
derivatives such as <code><a href="../reference/tm_polygons.html">tm_borders()</a></code> and
<code><a href="../reference/tm_symbols.html">tm_dots()</a></code>), but any layer of interest can be developed as
an extension of <strong>tmap</strong>. We will illustrate this below
with <code><a href="../reference/tm_cartogram.html">tm_cartogram()</a></code>. Other layers that are worthwhile to
implement are <code>tm_donuts()</code>, <code>tm_hexagons()</code>,
<code>tm_network()</code>, <code>tm_hillshade()</code>, etc.</p></li>
<li><p>Aesthetics: there will be many more visual variables available.
We will illustrate this in the next section, where we already
implemented 5 new aesthetics for <code><a href="../reference/tm_polygons.html">tm_polygons()</a></code>. Moreover,
it will be much easier for developers to add new visual variables to map
layer functions.</p></li>
<li><p>Graphics Engine: <strong>tmap v3</strong> contains two modes:
<code>plot</code> and <code>view</code> (which are based on
<code>grid</code> graphics and <code>leaflet</code> respectively) but
the framework makes it possible to add other modes as well.</p></li>
<li><p>Spatial data classes: <strong>tmap v3</strong> is build on
<code>sf</code> and <code>stars</code>. This will also be the case for
<strong>tmap v4</strong>, but for developers, it will be easier to
incorporate other classes as well, like <code>SpatRaster</code> and
<code>SpatVector</code> from <code>terra</code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="aesthetics">Aesthetics<a class="anchor" aria-label="anchor" href="#aesthetics"></a>
</h2>
<p>As mentioned before, we have added more aesthetics (visual
variables), and it will be easier for developers to add new aesthetics.
We have reordered the arguments that specify and configure the
aesthetics which will be illustrated below.</p>
<p>The arguments that specify aesthetics themselves will remain the
same. E.g., the main aesthetic in <code><a href="../reference/tm_polygons.html">tm_polygons()</a></code> is
<code>fill</code>, which defines the fill color of the polygons.</p>
<p>However, the other arguments of the layer functions are organized
differently. Thus, each aesthetic will only have four arguments:</p>
<ul>
<li>the aesthetic itself (<code>fill</code>)</li>
<li>the scale (<code>fill.scale</code>)</li>
<li>the legend (<code>fill.legend</code>)</li>
<li>an argument that decides whether scales are applied freely across
facets (<code>fill.free</code>)</li>
</ul>
<p>The scales and legends are discussed in the next sections.</p>
<p>Below you can see a basic comparison of the <strong>tmap</strong>
version 3 and 4 syntax:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"HPI"</span>, palette <span class="op">=</span> <span class="st">"Earth"</span>, title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"HPI"</span>, </span>
<span>                fill.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"purple_green"</span><span class="op">)</span>, </span>
<span>                fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-3-1.png" width="864"></p>
<p>In <strong>tmap v4</strong>, <code><a href="../reference/tm_polygons.html">tm_polygons()</a></code> will have the
aesthetics <code>fill</code>, <code>col</code>, <code>fill_alpha</code>,
<code>col_alpha</code>, <code>lwd</code>, <code>lty</code>, and
eventually also <code>pattern</code>. The other standard map layers will
also have additional aesthetics. A data variable can be mapped to each
of them, using different scales (see next section for an overview). The
next example uses <code>fill</code>, <code>lwd</code> (line width), and
<code>lty</code> (line type) as aesthetics:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="co"># ... not possible :(</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="va">World</span><span class="op">$</span><span class="va">life_exp_class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">World</span><span class="op">$</span><span class="va">life_exp</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">85</span>, by <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=eck4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"HPI"</span>, </span>
<span>                fill.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_continuous.html">tm_scale_continuous</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"purple_green"</span><span class="op">)</span>, </span>
<span>                fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span>,</span>
<span>                lwd <span class="op">=</span> <span class="st">"well_being"</span>,</span>
<span>                lwd.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_continuous.html">tm_scale_continuous</a></span><span class="op">(</span>value.neutral <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                                values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                                                label.na <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                lwd.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Well Being"</span><span class="op">)</span>,</span>
<span>                lty <span class="op">=</span> <span class="st">"life_exp_class"</span>,</span>
<span>                lty.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_categorical.html">tm_scale_ordinal</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>, <span class="st">"dashed"</span>, <span class="st">"solid"</span><span class="op">)</span>, </span>
<span>                                             value.na <span class="op">=</span> <span class="st">"blank"</span>, </span>
<span>                                             value.neutral <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>                                             label.na <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                lty.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Life Expectancy"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [plot mode] legend/component: Some components or legends are too high and are therefore rescaled. Set the tmap option 'component.autoscale' to FALSE to disable rescaling.</span></span></code></pre>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-5-1.png" width="864"></p>
<p>Besides these <strong>visual mapping aesthetics</strong>, which map
data variables to visual variables, there is also another group of
aesthetics, namely <strong>(data-driven) transformation
aesthetics</strong>. They are used to transform spatial objects. We call
it data-driven, because content data are used as input for this spatial
transformation. An example is the cartogram, which will be shown in the
next section. The polygons are distorted such that the size will be
(approximately) proportional to a data variable.</p>
</div>
<div class="section level2">
<h2 id="map-layers-e-g--cartogram">Map layers (e.g. cartogram)<a class="anchor" aria-label="anchor" href="#map-layers-e-g--cartogram"></a>
</h2>
<p>It will be easy for developers to add new map layers as extension. We
illustrate this by a new map layer, <code><a href="../reference/tm_cartogram.html">tm_cartogram()</a></code>.</p>
<p>Cartograms could already be made with <strong>tmap v3</strong>, but
it explicitly required transforming the data using the
<strong>cartogram</strong> package before mapping.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjewo/cartogram" class="external-link">cartogram</a></span><span class="op">)</span></span>
<span><span class="va">World_carto</span> <span class="op">=</span> <span class="va">World</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=eck4"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/cartogram/man/cartogram_cont.html" class="external-link">cartogram_cont</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"pop_est"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World_carto</span>, crs <span class="op">=</span> <span class="st">"+proj=eck4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="va">fill</span>, </span>
<span>              palette <span class="op">=</span> <span class="st">"Earth"</span>, </span>
<span>              title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span></span></code></pre></div>
<p>In <strong>tmap v4</strong>, there will be a direct function
<code><a href="../reference/tm_cartogram.html">tm_cartogram()</a></code> (using the <strong>cartogram</strong>
package under the hood), which uses the transformation aesthetic
<code>size</code> and inherits all visual aesthetics from
<code><a href="../reference/tm_polygons.html">tm_polygons()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"cartogram"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=eck4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_cartogram.html">tm_cartogram</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"pop_est"</span>,</span>
<span>                 fill <span class="op">=</span> <span class="st">"HPI"</span>, </span>
<span>                 fill.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"purple_green"</span><span class="op">)</span>,</span>
<span>                 fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_extra_innner_margin.html">tm_place_legends_right</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-7-1.png" width="864"></p>
<p>A nice benefit of having cartograms directly in <strong>tmap</strong>
is that it makes possible to use the available scaling functions. For
example, suppose we want to apply a log 10 scale in order to make the
cartogram a bit more “balanced”:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjewo/cartogram" class="external-link">cartogram</a></span><span class="op">)</span></span>
<span><span class="va">World_carto</span> <span class="op">=</span> <span class="va">World</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=eck4"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pop_est_log10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">pop_est</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/cartogram/man/cartogram_cont.html" class="external-link">cartogram_cont</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="st">"pop_est_log10"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World_carto</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="va">fill</span>, </span>
<span>              palette <span class="op">=</span> <span class="st">"Earth"</span>, </span>
<span>              title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"cartogram"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=eck4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_cartogram.html">tm_cartogram</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"pop_est"</span>,</span>
<span>                 size.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_continuous.html">tm_scale_continuous_log1p</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 fill <span class="op">=</span> <span class="st">"HPI"</span>, </span>
<span>                 fill.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"purple_green"</span><span class="op">)</span>,</span>
<span>                 fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Happy Planet Index"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_extra_innner_margin.html">tm_place_legends_right</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-9-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="scales">Scales<a class="anchor" aria-label="anchor" href="#scales"></a>
</h2>
<p>Scales are used to map data variables to visual variables. Scales are
not new in <strong>map v4</strong>, but they are used more
explicitly.</p>
<p>The following table shows the scales that are currently
available:</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Scale</th>
<th>Main Data Type</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/tm_scale_categorical.html">tm_scale_categorical()</a></code></td>
<td>categorical (<code>factor</code>)</td>
<td>Fruit type</td>
</tr>
<tr class="even">
<td><code><a href="../reference/tm_scale_categorical.html">tm_scale_ordinal()</a></code></td>
<td>categorical (<code>ordered</code>)</td>
<td>Education level</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/tm_scale_intervals.html">tm_scale_intervals()</a></code></td>
<td>numerical (<code>integer</code> or <code>numeric</code>)</td>
<td>Age group</td>
</tr>
<tr class="even">
<td><code><a href="../reference/tm_scale_continuous.html">tm_scale_continuous()</a></code></td>
<td>numerical (<code>numeric</code>)</td>
<td>Height</td>
</tr>
<tr class="odd">
<td><code>tm_scale_log10()</code></td>
<td>numerical (<code>numeric</code>)</td>
<td>Income</td>
</tr>
<tr class="even">
<td><code><a href="../reference/tm_scale_discrete.html">tm_scale_discrete()</a></code></td>
<td>numerical (<code>integer</code>)</td>
<td>Number of children</td>
</tr>
</tbody>
</table>
<p>The main data type (second column) is the data type for which the
scale is supposed to be applied. Any scale can be applied to any data
type (even though it might not make sense), with one exception:
continuous (and log10) scales cannot be applied to visual variables that
can only take a finite set of values. Examples are symbol shape and line
type. By default, <code><a href="../reference/tm_scale_categorical.html">tm_scale_categorical()</a></code>,
<code><a href="../reference/tm_scale_categorical.html">tm_scale_ordinal()</a></code>, and <code><a href="../reference/tm_scale_intervals.html">tm_scale_intervals()</a></code>
are used for data of class <code>factor</code>, <code>ordered</code> and
<code>numeric</code> respectively. Scales for date/time variables will
be included as well.</p>
<p>The main argument of each scale function is <code>values</code>,
which are the values for the visual variables. The following table shows
which type of values are required for which visual variable:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Visual variable</th>
<th>Type of values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>fill</code> and <code>col</code>
</td>
<td>Color palette</td>
</tr>
<tr class="even">
<td>
<code>size</code> and <code>lwd</code>
</td>
<td>(Exponential) value range</td>
</tr>
<tr class="odd">
<td><code>lty</code></td>
<td>Line types, e.g. <code>"dashed"</code>
</td>
</tr>
<tr class="even">
<td><code>shape</code></td>
<td>Shapes (probably similar as in <strong>tmap v3</strong>)</td>
</tr>
<tr class="odd">
<td>
<code>fill_alpha</code> and <code>col_alpha</code>
</td>
<td>Value range</td>
</tr>
</tbody>
</table>
<p>The default values depend not only on the visual variable, but also
on the scale and on whether data values are diverging. For instance, if
<code><a href="../reference/tm_scale_intervals.html">tm_scale_intervals()</a></code> is applied to a numeric variable with
both negative and positive values where the visual variable is
<code>fill</code>, then a diverging color palette is used.</p>
<p>The following map illustrates what happens when the six scale
functions are applied to the same data variable. We use the variable
<em>life expectancy</em> (which we round in order to make sure the
number of unique values is limited):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span></span>
<span><span class="va">Africa</span> <span class="op">=</span> <span class="va">World</span><span class="op">[</span><span class="va">World</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span>, <span class="op">]</span></span>
<span><span class="va">Africa</span><span class="op">$</span><span class="va">life_exp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Africa</span><span class="op">$</span><span class="va">life_exp</span><span class="op">)</span></span></code></pre></div>
<p>Scales existed in <strong>tmap v3</strong>, but they were applied
implicitly via several arguments:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Africa</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"life_exp"</span>, <span class="fl">5</span><span class="op">)</span>, style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"cat"</span>, <span class="st">"pretty"</span>, <span class="st">"cont"</span>, <span class="st">"log10"</span><span class="op">)</span>,</span>
<span>                palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Set2"</span>, <span class="st">"YlOrBr"</span>, <span class="st">"YlOrBr"</span>, <span class="st">"YlOrBr"</span>, <span class="st">"YlOrBr"</span><span class="op">)</span>,</span>
<span>                title <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>panel.labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"categorical scale"</span>, <span class="st">"ordinal scale"</span>, <span class="st">"intervals scale"</span>, <span class="st">"continuous scale"</span>, <span class="st">"log10 scale"</span><span class="op">)</span>,</span>
<span>              inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>              legend.text.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># discrete scale is not possible directly, but only  via interval breaks:</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Africa</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"life_exp"</span>, style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                palette <span class="op">=</span> <span class="st">"YlOrBr"</span>,</span>
<span>                breaks <span class="op">=</span> <span class="fl">49</span><span class="op">:</span><span class="fl">76</span>,</span>
<span>                as.count <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                title <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>panel.labels <span class="op">=</span> <span class="st">"discrete scale"</span>, </span>
<span>              inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>              legend.text.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Africa</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"life_exp"</span>, <span class="fl">6</span><span class="op">)</span>, </span>
<span>                fill.scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/tm_scale_categorical.html">tm_scale_categorical</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="../reference/tm_scale_categorical.html">tm_scale_ordinal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="../reference/tm_scale_continuous.html">tm_scale_continuous</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="../reference/tm_scale_continuous.html">tm_scale_continuous_log</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="../reference/tm_scale_discrete.html">tm_scale_discrete</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, position <span class="op">=</span> <span class="fu"><a href="../reference/tm_pos.html">tm_pos_in</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>panel.labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tm_scale_categorical"</span>, <span class="st">"tm_scale_ordinal"</span>, <span class="st">"tm_scale_intervals"</span>, <span class="st">"tm_scale_continuous"</span>, <span class="st">"tm_scale_continuous_log"</span>, <span class="st">"tm_scale_discrete"</span><span class="op">)</span>, </span>
<span>              inner.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>              legend.text.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-12-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="multivariate-scales">Multivariate Scales<a class="anchor" aria-label="anchor" href="#multivariate-scales"></a>
</h2>
<p>It will be possible to assign multiple variables for one aesthetic.
This can be done with the function <code>tm_mv()</code> (which stands
for multivariate). An example is the bivariate choropleth, which is not
yet implemented, but will definitely be.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="../reference/tm_vars.html">tm_vars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"well_being"</span>, <span class="st">"footprint"</span><span class="op">)</span>, multivariate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    fill.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_bivariate.html">tm_scale_bivariate</a></span><span class="op">(</span>scale1 <span class="op">=</span>  <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    scale2 <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    values <span class="op">=</span> <span class="st">"brewer.qualseq"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Labels abbreviated by the first letters, e.g.: "0 to 3" =&gt; "0"</span></span></code></pre>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-13-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="legends">Legends<a class="anchor" aria-label="anchor" href="#legends"></a>
</h2>
<p>As you may have noticed in the previous examples, the legends look a
bit differently by default.</p>
<div class="section level3">
<h3 id="positioning">Positioning<a class="anchor" aria-label="anchor" href="#positioning"></a>
</h3>
<p>Legends are currently placed outside the map by default in
<strong>tmap v4</strong>. Why? Simply because there is often more space
than inside the map.</p>
<p>Furthermore, it is possible to place legends on different locations
across the map:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="co"># ... not possible :(</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"HPI"</span>,</span>
<span>             size <span class="op">=</span> <span class="st">"pop_est"</span>,</span>
<span>             shape <span class="op">=</span> <span class="st">"income_grp"</span>,</span>
<span>             size.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale.html">tm_scale</a></span><span class="op">(</span>value.neutral <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>             fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span><span class="st">"Happy Planet Index"</span>, position <span class="op">=</span> <span class="fu"><a href="../reference/tm_pos.html">tm_pos_in</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             size.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span><span class="st">"Population"</span>, position <span class="op">=</span> <span class="fu"><a href="../reference/tm_pos.html">tm_pos_out</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"center"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             shape.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span><span class="st">"Income Group"</span>, position <span class="op">=</span> <span class="fu"><a href="../reference/tm_pos.html">tm_pos_out</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-15-1.png" width="864"></p>
<p><strong>tmap v3</strong> contains many (often complicated) options
for rather simple things. These options are set globally via
<code><a href="../reference/tmap_options.html">tmap_options()</a></code> or within a single plot with
<code><a href="../reference/tm_layout.html">tm_layout()</a></code>.</p>
<p>In <strong>tmap v4</strong>, the directly related to the layout are
accessible via <code><a href="../reference/tm_layout.html">tm_layout()</a></code>. However, to ease its use, there
will be a bunch of handy shortcut functions, such as
<code><a href="../reference/tm_extra_innner_margin.html">tm_place_legends_left()</a></code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"HPI"</span>,</span>
<span>             size <span class="op">=</span> <span class="st">"pop_est"</span>,</span>
<span>             shape <span class="op">=</span> <span class="st">"income_grp"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside.position <span class="op">=</span> <span class="st">"left"</span>, legend.outside.size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"HPI"</span>,</span>
<span>             size <span class="op">=</span> <span class="st">"pop_est"</span>,</span>
<span>             shape <span class="op">=</span> <span class="st">"income_grp"</span>,</span>
<span>             size.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale.html">tm_scale</a></span><span class="op">(</span>value.neutral <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_extra_innner_margin.html">tm_place_legends_left</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [plot mode] legend/component: Some components or legends are too high and are therefore rescaled. Set the tmap option 'component.autoscale' to FALSE to disable rescaling.</span></span></code></pre>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-17-1.png" width="864"></p>
</div>
<div class="section level3">
<h3 id="combined-legends">Combined legends<a class="anchor" aria-label="anchor" href="#combined-legends"></a>
</h3>
<p>Another new feature is possibility to combine legends directly, which
was quite a hassle in <strong>tmap v3</strong>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">metro</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"pop2020"</span>, </span>
<span>           n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>           size <span class="op">=</span> <span class="st">"pop2020"</span>,</span>
<span>           legend.size.show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>           legend.col.show <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="../reference/tm_add_legend.html">tm_add_legend</a></span><span class="op">(</span><span class="st">"symbol"</span>, </span>
<span>              col <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"YlOrRd"</span><span class="op">)</span>,</span>
<span>              border.col <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>              size <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op">/</span> <span class="fl">40e6</span><span class="op">)</span> <span class="op">^</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fl">2</span>,</span>
<span>              labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0 mln to 10 mln"</span>, <span class="st">"10 mln to 20 mln"</span>, <span class="st">"20 mln to 30 mln"</span>, <span class="st">"30 mln to 40 mln"</span><span class="op">)</span>,</span>
<span>              title <span class="op">=</span> <span class="st">"Population in 2020"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, legend.outside.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">metro</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"pop2020"</span>,</span>
<span>               fill.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend</a></span><span class="op">(</span><span class="st">"Population in 2020"</span><span class="op">)</span>,</span>
<span>               size <span class="op">=</span> <span class="st">"pop2020"</span>,</span>
<span>               size.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>               size.legend <span class="op">=</span> <span class="fu"><a href="../reference/tm_legend.html">tm_legend_combine</a></span><span class="op">(</span><span class="st">"fill"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-19-1.png" width="864"></p>
</div>
<div class="section level3">
<h3 id="spacing-between-items">Spacing between items<a class="anchor" aria-label="anchor" href="#spacing-between-items"></a>
</h3>
<p>The design of the legends is (and will further be) improved. Most
prominently, there is a <code>space</code> argument that determines the
height of a legend item. More specifically, each legend item will be
<code>1 + space</code> line-height. This is also useful to make
continuous legends better.</p>
</div>
</div>
<div class="section level2">
<h2 id="facets">Facets<a class="anchor" aria-label="anchor" href="#facets"></a>
</h2>
<p>In <strong>tmap v4</strong>, there are convenient wrappers
<code>tm_facet_wrap()</code> and <code>tm_facet_grid()</code>, where the
former wraps the facets, and the latter places the facets in a grid
layout.</p>
<p>Furthermore, each visual variable has a <code>free</code> argument,
which determines whether scales are free (<code>TRUE</code>) or shared
(<code>FALSE</code>) across facets.</p>
<p>In <strong>tmap v3</strong> this <code>free</code> argument could be
set via <code><a href="../reference/tm_facets.html">tm_facets()</a></code>, whereas in <strong>tmap v4</strong>
this argument has been moved to the layer functions:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"life_exp"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_facets.html">tm_facets</a></span><span class="op">(</span><span class="st">"continent"</span>, nrow <span class="op">=</span> <span class="fl">1</span>, free.scales.fill <span class="op">=</span> <span class="cn">FALSE</span>, free.coords <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"life_exp"</span>, fill.free <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_facets.html">tm_facets_wrap</a></span><span class="op">(</span><span class="st">"continent"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [plot mode] fit legend/component: Some legend items or map compoments do not fit well, and are therefore rescaled. Set the tmap option 'component.autoscale' to FALSE to disable rescaling.</span></span></code></pre>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-21-1.png" width="864"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"life_exp"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_facets.html">tm_facets</a></span><span class="op">(</span><span class="st">"continent"</span>, nrow <span class="op">=</span> <span class="fl">1</span>, free.scales.fill <span class="op">=</span> <span class="cn">TRUE</span>, free.coords <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"life_exp"</span>, fill.free <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_facets.html">tm_facets_stack</a></span><span class="op">(</span><span class="st">"continent"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Variable(s) "fill" only contains NAs. Legend disabled for tm_scale_intervals, unless breaks are specified</span></span>
<span><span class="co">## Variable(s) "fill" only contains NAs. Legend disabled for tm_scale_intervals, unless breaks are specified</span></span></code></pre>
<pre><code><span><span class="co">## [plot mode] fit legend/component: Some legend items or map compoments do not fit well, and are therefore rescaled. Set the tmap option 'component.autoscale' to FALSE to disable rescaling.</span></span></code></pre>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-23-1.png" width="864"></p>
<p>New in <strong>tmap v4</strong> is that for facet grid, the
<code>free</code> argument can be specified differently for rows and
columns, as we will show in the next complex (sorry for that)
example:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v3</span></span>
<span><span class="co"># ... not possible :(</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span>, crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">World</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"life_exp"</span>, </span>
<span>                fill.scale <span class="op">=</span> <span class="fu"><a href="../reference/tm_scale_intervals.html">tm_scale_intervals</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"brewer.greens"</span><span class="op">)</span>,</span>
<span>                fill.free <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="cn">FALSE</span>, columns <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"gdp_cap_est"</span>, </span>
<span>               size.free <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="cn">TRUE</span>, columns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>               fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_facets.html">tm_facets_grid</a></span><span class="op">(</span><span class="st">"income_grp"</span>, <span class="st">"economy"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>meta.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">0</span>, <span class="fl">0</span>,<span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [plot mode] fit legend/component: Some legend items or map compoments do not fit well, and are therefore rescaled. Set the tmap option 'component.autoscale' to FALSE to disable rescaling.</span></span></code></pre>
<p><img src="tmap_sneak_peek_files/figure-html/unnamed-chunk-25-1.png" width="864"></p>
<p>What you see in the map is that life expectancy is shown as polygon
fill in green, and GDP per capita as red bubbles. The maps are grouped
by income group (rows) and economy (columns). The scale for life
expectancy is set to free for the columns. This means that the scale
will be applied for each column separately, with a legend per column.
The scale for GDP per capita is applied separately for each row.</p>
</div>
<div class="section level2">
<h2 id="graphic-engines-modes">Graphic Engines (modes)<a class="anchor" aria-label="anchor" href="#graphic-engines-modes"></a>
</h2>
<p>Just like <strong>tmap v3</strong>, there will be a
<code>"plot"</code> and a <code>"view"</code> mode. However, the
framework used in <strong>tmap v4</strong> also facilitates developers
to write plotting methods for other modes.</p>
<p>For instance, <strong>CesiumJS</strong> is a great JavaScript library
for 3d globe visualizations. It would be awesome to include this in
<strong>R</strong>. When there is a low-level interface between
<strong>CesiumJS</strong> and <strong>R</strong> (similar to the R
package <strong>leaflet</strong> being an interface between the JS
library <strong>leaflet</strong> and <strong>R</strong>), it will be
relatively easy for developers to add a new mode for these 3d
visualizations in <strong>tmap v4</strong>.</p>
</div>
<div class="section level2">
<h2 id="backward-compatibility">Backward compatibility<a class="anchor" aria-label="anchor" href="#backward-compatibility"></a>
</h2>
<p>In this early development stage, <strong>tmap v3</strong> code will
not work with <strong>tmap v4</strong>. However, when <strong>tmap
v4</strong> will be stable, it will be backwards compatible. Layer
function arguments that are no longer used, such as <code>breaks</code>
and <code>palette</code> will be deprecated, and internally redirected
to the new scale functions.</p>
<p>Furthermore, some of the options will have other options in
<strong>tmap v4</strong>. For instance, legends will be placed outside
of the maps by default, and there will be a small space between legend
items as shown above.</p>
<p>In order to keep the layout as close as possible to <strong>tmap
v3</strong>, there will be a style which will set the options back to
the settings used by default in <strong>tmap v3</strong>. This can be
set with just one command: <code>tmap_style("tmap_v3")</code></p>
</div>
<div class="section level2">
<h2 id="color-palettes">Color palettes<a class="anchor" aria-label="anchor" href="#color-palettes"></a>
</h2>
<p>There will be a huge number of directly available color palettes. We
have not settled on the exact details, e.g. which palettes to include,
and how they can be obtained. Ideas are welcome (<a href="https://github.com/r-tmap/tmap/issues/566" class="external-link uri">https://github.com/r-tmap/tmap/issues/566</a>).</p>
<p>In the current development version, there is a function similar to
<code><a href="https://rdrr.io/pkg/tmaptools/man/palette_explorer.html" class="external-link">tmaptools::palette_explorer()</a></code>, which renders a long png in
the viewer pane of RStudio or the browser:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tmap v4</span></span>
<span><span class="fu">tmap_show_palettes</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><a href="https://user-images.githubusercontent.com/2444081/122725374-352bc680-d275-11eb-9a1c-0a88e4a97848.png" class="external-link"><img src="https://user-images.githubusercontent.com/2444081/122732106-3ad8da80-d27c-11eb-98fd-1aafd6d7a52b.png"></a></p>
<p>(click on the image to see the full png)</p>
<p>It is also possible to render this for color blindness simulation,
e.g.:
<code>tmap_show_palettes(color_vision_deficiency = "deutan")</code>.</p>
<p>All default palettes that we use will be usable for color blind
people.</p>
</div>
<div class="section level2">
<h2 id="suggestions">Suggestions<a class="anchor" aria-label="anchor" href="#suggestions"></a>
</h2>
<p>Do you have any suggestions? Please let us know! Via <a href="https://github.com/r-tmap/tmap/issues" class="external-link uri">https://github.com/r-tmap/tmap/issues</a>, and please use
the <strong>tmap_v4</strong> tag.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martijn Tennekes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
